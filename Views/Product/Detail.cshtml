@model Product

@{
    var colors = Model.Productvariants
    .Select(x => x.Color?.ColorName)
    .Where(c => !string.IsNullOrEmpty(c))
    .Distinct()
    .ToList();
}


<div class="container py-5">
    <div class="row g-5">
        <!-- Ảnh sản phẩm -->
        <div class="col-md-6">
            <div class="mb-3">
                <img id="mainProductImg" src="@(Model.Productimages.FirstOrDefault(img => img.IsThumbnail == true)?.ImageUrl 
                                                                    ?? Model.Productimages.FirstOrDefault()?.ImageUrl 
                                                                    ?? "https://via.placeholder.com/500x600?text=No+Image")" class="img-fluid rounded w-100"
                    style="max-height:520px;object-fit:cover;" alt="@Model.ProductName" />
            </div>

            <div class="d-flex gap-2 flex-wrap">
                @foreach (var img in Model.Productimages.Take(6))
                {
                    <img src="@img.ImageUrl" class="img-thumbnail thumb-img"
                        style="width:90px;height:110px;object-fit:cover;cursor:pointer;" alt="@Model.ProductName" />
                }
            </div>
        </div>

        <!-- Thông tin sản phẩm -->
        <div class="col-md-6">
            <h2 class="fw-bold mb-2" style="font-size:2rem;">@Model.ProductName</h2>
            <div class="mb-2 text-secondary">
                Mã: <span class="fw-semibold">@Model.ProductId</span>
            </div>
            <div class="mb-2">
                Thương hiệu: <span class="fw-semibold">@Model.Category?.CategoryName</span> |
                Tình trạng: <span class="fw-semibold text-success">Còn hàng</span>
            </div>
            <div class="mb-3">
                <span class="fs-3 fw-bold text-danger">
                    @string.Format("{0:N0}₫", Model.Productvariants.FirstOrDefault()?.Price ?? 0)
                </span>
            </div>
            <hr />
            <div class="mb-3 text-secondary">
                @(string.IsNullOrEmpty(Model.Description) ? "Mô tả đang cập nhật" : Model.Description)
            </div>

            <div class="mb-3">
                <div class="mb-2 fw-semibold">SIZE:</div>
                <div class="d-flex gap-2 flex-wrap">
                    @foreach (var sizeName in Model.Productvariants.Select(x => x.Size?.SizeName).Distinct())
                    {
                        if (!string.IsNullOrEmpty(sizeName))
                        {
                            <button class="btn btn-outline-dark btn-sm">@sizeName</button>
                        }
                    }
                </div>
            </div>

            @if (colors.Any())
            {
                <div class="mb-3">
                    <div class="mb-2 fw-semibold">MÀU:</div>
                    <div class="d-flex gap-2 flex-wrap">
                        @foreach (var colorName in colors)
                        {
                            <div class="d-flex align-items-center mb-1">
                                <button class="btn btn-outline-light border me-2"
                                    style="background:@GetColorCode(colorName); width:32px; height:32px;"></button>
                                <span>@colorName</span>
                            </div>
                        }
                    </div>
                </div>
            }

            <div class="mb-3">
                <div class="mb-2 fw-semibold">Sản phẩm đi kèm</div>
                <button class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-plus-circle"></i> Sản phẩm đi kèm
                </button>
            </div>

            <div class="mb-4 d-flex align-items-center gap-2">
                <button class="btn btn-outline-dark px-2">-</button>
                <input type="text" value="1" class="form-control text-center" style="width:60px;" />
                <button class="btn btn-outline-dark px-2">+</button>
                <button class="btn btn-dark ms-3 px-4">THÊM VÀO GIỎ HÀNG</button>
                <button class="btn btn-outline-secondary ms-2">
                    <i class="bi bi-heart"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Script để đổi ảnh khi click thumbnail -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const mainImg = document.getElementById('mainProductImg');
        document.querySelectorAll('.thumb-img').forEach(function (thumb) {
            thumb.addEventListener('click', function () {
                mainImg.src = this.src;
            });
        });
    });
</script>

@functions {
    string GetColorCode(string colorName)
    {
        return colorName switch
        {
            "Đen" => "#000",
            "Trắng" => "#fff",
            "Xám" => "#888",
            "Đỏ" => "#e53935",
            "Cam" => "#ff7043",
            "Tím" => "#8e24aa",
            _ => "#ccc"
        };
    }
}